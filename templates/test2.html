<script>
    // Define the URLs for images using Django template syntax
    const hangmanImageURLs = [
        "{% static 'images/hangman-0.svg' %}",
        "{% static 'images/hangman-1.svg' %}",
        "{% static 'images/hangman-2.svg' %}",
        "{% static 'images/hangman-3.svg' %}",
        "{% static 'images/hangman-4.svg' %}",
        "{% static 'images/hangman-5.svg' %}",
        "{% static 'images/hangman-6.svg' %}"
    ];

    // Initialize other constants
    const wordDisplay = document.querySelector(".word-display");
    const guessesText = document.querySelector(".guesses-text b");
    const keyboardDiv = document.querySelector(".keyboard");
    const hangmanImage = document.querySelector(".hangman-box img");
    const gameModal = document.querySelector(".game-modal");
    const playAgainBtn = gameModal.querySelector("button");

    // Initializing game variables
    let currentWordIndex = 0;
    let correctLetters, wrongGuessCount;
    const maxGuesses = 6;

    const resetGame = () => {
        // Resetting game variables and UI elements
        correctLetters = [];
        wrongGuessCount = 0;
        hangmanImage.src = hangmanImageURLs[0]; // Set initial hangman image
        guessesText.innerText = `${wrongGuessCount} / ${maxGuesses}`;
        const currentWord = wordList[currentWordIndex];
        wordDisplay.innerHTML = currentWord.word.split("").map(() => `<li class="letter"></li>`).join("");
        document.querySelector(".hint-text b").innerText = currentWord.hint;
        keyboardDiv.querySelectorAll("button").forEach(btn => btn.disabled = false);
        gameModal.classList.remove("show");
    };

    const victoryImageURL = "{% static 'images/victory.gif' %}";
    const lostImageURL = "{% static 'images/lost.gif' %}";

    const gameOver = (isVictory) => {
        gameModal.querySelector("img").src = isVictory ? victoryImageURL : lostImageURL;
        gameModal.querySelector("h4").innerText = isVictory ? 'Congrats!' : 'Game Over!';
        gameModal.classList.add("show");
        
        if (isVictory) {
            playAgainBtn.style.display = "none";
            document.querySelector(".click-me").style.display = "inline-block";
        } else {
            playAgainBtn.style.display = "inline-block";
            document.querySelector(".click-me").style.display = "none";
        }
    };

    const initGame = (button, clickedLetter) => {
        // Checking if clickedLetter exists in the currentWord
        const currentWord = wordList[currentWordIndex];
        if (currentWord.word.includes(clickedLetter)) {
            // Showing all correct letters on the word display
            [...currentWord.word].forEach((letter, index) => {
                if (letter === clickedLetter) {
                    correctLetters.push(letter);
                    wordDisplay.querySelectorAll("li")[index].innerText = letter;
                    wordDisplay.querySelectorAll("li")[index].classList.add("guessed");
                }
            });
        } else {
            // If clicked letter doesn't exist then update the wrongGuessCount and hangman image
            wrongGuessCount++;
            hangmanImage.src = hangmanImageURLs[wrongGuessCount];
        }
        button.disabled = true; // Disable the clicked button so user can't click again
        guessesText.innerText = `${wrongGuessCount} / ${maxGuesses}`;

        // Call gameOver function if any of these conditions are met
        if (wrongGuessCount === maxGuesses) return gameOver(false);
        if (correctLetters.length === currentWord.word.length) {
            currentWordIndex++;
            if (currentWordIndex < wordList.length) {
                resetGame();
            } else {
                return gameOver(true);
            }
        }
    };

    // Creating keyboard buttons and adding event listeners
    for (let i = 97; i <= 122; i++) {
        const button = document.createElement("button");
        button.innerText = String.fromCharCode(i);
        keyboardDiv.appendChild(button);
        button.addEventListener("click", (e) => initGame(e.target, String.fromCharCode(i)));
    }
    for (let i = 48; i <= 57; i++) {
        const button = document.createElement("button");
        button.innerText = String.fromCharCode(i);
        keyboardDiv.appendChild(button);
        button.addEventListener("click", (e) => initGame(e.target, String.fromCharCode(i)));
    }

    resetGame(); // Initialize the game
    playAgainBtn.addEventListener("click", () => {
        currentWordIndex = 0;
        resetGame();
        window.location.reload(); // Reload the page to play again
    });
</script>
